<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>SƒÉn G·∫•u B√¥ng CGV c√πng KhoaCGV</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .wheel-container {
      margin-top: 40px;
    }

    .wheel-container h2 {
      font-size: 32px;
      color: #e74c3c;
      margin-bottom: 5px;
    }

    .wheel-container p {
      font-size: 18px;
      color: #333;
      margin-bottom: 20px;
    }

    canvas {
      border-radius: 50%;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }

    #spin {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 18px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #spin:hover:enabled {
      background-color: #2980b9;
    }

    #spin:disabled {
      background-color: #bdc3c7;
      cursor: not-allowed;
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      color: #27ae60;
      font-weight: bold;
    }

    .pointer {
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 30px solid #e74c3c;
      /* ƒê·ªïi t·ª´ border-bottom sang border-top */
      margin: -20px auto 10px;
      /* ƒêi·ªÅu ch·ªânh v·ªã tr√≠ l√™n tr√™n canvas */
      position: relative;
      z-index: 1;
      margin: 10px auto -20px;

    }


    .bottom-image {
      width: 500px;
      margin-top: 20px;
      border-radius: 10px;
    }
  </style>
</head>

<body>
  <div class="wheel-container">
    <h2>üéâ V√≤ng Quay Gi·∫£m Gi√° L·∫ßn ƒê·∫∑t Sau üéâ</h2>
    <p>H√£y th·ª≠ v·∫≠n may c·ªßa b·∫°n ƒë·ªÉ nh·∫≠n m√£ gi·∫£m gi√° h·∫•p d·∫´n!</p>
    <div class="pointer"></div>
    <canvas id="wheel" width="500" height="500"></canvas>
    <br>
    <button id="spin">Quay Ngay</button>
    <p id="result"></p>
    <p class="screenshot-note">üì∏ Vui l√≤ng ch·ª•p l·∫°i m√†n h√¨nh k·∫øt qu·∫£ sau khi quay ƒë·ªÉ nh·∫≠n th∆∞·ªüng!</p>

    <img src="fb.png" alt="·∫¢nh minh h·ªça" class="bottom-image">

  </div>

  <!-- √Çm thanh ph√°t khi quay -->
  <audio id="spinSound" src="nhac-xo-so.mp3"></audio>

  <script>
    if (!("ontouchstart" in window)) {
      document.body.innerHTML = "<h2>Vui l√≤ng d√πng ƒëi·ªán tho·∫°i ƒë·ªÉ quay!</h2>";
    }

    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");

    // S·ª≠a t√™n segment
    const segments = [
      "Gi·∫£m gi√° 10k v√© phim",
      "G·∫•u b√¥ng CGV",
      "Gi·∫£m gi√° 5k b·∫Øp n∆∞·ªõc",
      "Gi·∫£m gi√° 5k v√© phim",
      "Gi·∫£m gi√° 50k v√© phim",
      "+1 l∆∞·ª£t quay"
    ];

    const colors = ["#A3E4D7", "#F9E79F", "#FADBD8", "#D5A6BD", "#00FF00", "#85C1AE"];
    const spinBtn = document.getElementById("spin");
    const result = document.getElementById("result");
    const spinSound = document.getElementById("spinSound");

    let startAngle = 0;
    const arc = Math.PI * 2 / segments.length;
    let spinAngle = 0;

    // ‚≠ê ·∫¢NH JOLLIBEE ·ªû GI·ªÆA V√íNG QUAY ‚≠ê
    const centerImage = new Image();
    centerImage.src = "gaucgv.jpg"; // ƒë·ªïi ·∫£nh n·∫øu c·∫ßn

    centerImage.onload = () => {
      drawWheel(); // V·∫Ω l·∫°i khi ·∫£nh load xong
    };

    function drawWheel() {
      for (let i = 0; i < segments.length; i++) {
        const angle = startAngle + i * arc;
        ctx.fillStyle = colors[i];
        ctx.beginPath();
        ctx.moveTo(250, 250);
        ctx.arc(250, 250, 250, angle, angle + arc);
        ctx.closePath();
        ctx.fill();

        ctx.save();
        ctx.translate(250, 250);
        ctx.rotate(angle + arc / 2);
        ctx.fillStyle = "#333";
        ctx.font = "bold 16px Arial";
        ctx.textAlign = "center";
        ctx.fillText(segments[i], 150, 10);
        ctx.restore();

      }
      ctx.save();
      const size = 110;
      const radius = size / 2;

      // ƒê·ªï b√≥ng nh·∫π
      ctx.shadowColor = "rgba(0,0,0,0.3)";
      ctx.shadowBlur = 15;

      // Border tr·∫Øng
      ctx.beginPath();
      ctx.arc(250, 250, radius + 6, 0, Math.PI * 2);
      ctx.fillStyle = "white";
      ctx.fill();

      // Clip ·∫£nh tr√≤n
      ctx.beginPath();
      ctx.arc(250, 250, radius, 0, Math.PI * 2);
      ctx.clip();

      // V·∫Ω ·∫£nh
      ctx.drawImage(centerImage, 250 - radius, 250 - radius, size, size);

      ctx.restore();

    }
    drawWheel();

    function hasUserSpunToday() {
      const today = new Date().toISOString().split('T')[0];
      const lastSpinDate = localStorage.getItem("lastSpinDate");

      const bonusSpin = localStorage.getItem("bonusSpin");
      if (bonusSpin === "true") {
        result.innerText = localStorage.getItem("result") || "üéÅ B·∫°n c√≥ 1 l∆∞·ª£t quay th∆∞·ªüng üéÅ";
        return false;
      }

      return lastSpinDate === today;
    }

    if (hasUserSpunToday()) {
      spinBtn.disabled = true;
      result.innerText = localStorage.getItem("result");
    }

    function spinWheel() {
      spinBtn.disabled = true;

      spinSound.currentTime = 0;
      spinSound.play();

      setTimeout(() => {

        // ‚ùå Lo·∫°i "Tu·∫ßn l·ªôc" v√† "Gi·∫£m gi√° 50k v√© phim"
        const invalid = ["G·∫•u b√¥ng CGV", "Gi·∫£m gi√° 50k v√© phim"];
        const validIndexes = segments
          .map((value, idx) => !invalid.includes(value) ? idx : -1)
          .filter(idx => idx !== -1);

        const selectedIndex = validIndexes[Math.floor(Math.random() * validIndexes.length)];
        const stopAngle = (Math.PI * 3 / 2) - (selectedIndex * arc) - (arc / 2);
        const spins = Math.floor(Math.random() * 10 + 5);
        const totalAngle = spins * 2 * Math.PI + stopAngle;

        const duration = 6000;
        const start = performance.now();

        function animate(now) {
          const elapsed = now - start;
          const progress = Math.min(elapsed / duration, 1);
          spinAngle = totalAngle * easeOutCubic(progress);
          startAngle = spinAngle % (Math.PI * 2);

          ctx.clearRect(0, 0, canvas.width, canvas.height);
          drawWheel();

          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {

            let normalizedAngle = (2 * Math.PI - (spinAngle % (2 * Math.PI)) + Math.PI * 3 / 2) % (2 * Math.PI);
            let index = Math.floor(normalizedAngle / arc);

            // N·∫øu r∆°i v√†o 2 √¥ b·ªã c·∫•m, t·ª± chuy·ªÉn sang √¥ k·∫ø b√™n an to√†n
            if (invalid.includes(segments[index])) {
              index = validIndexes[0];
            }

            const spinResult = segments[index];
            result.innerText = "üéÅ B·∫°n tr√∫ng: " + spinResult + " üéÅ";

            localStorage.setItem("result", result.innerText);

            if (spinResult === "+1 l∆∞·ª£t quay") {
              spinBtn.disabled = false;
              localStorage.setItem("bonusSpin", "true");
            } else {
              localStorage.removeItem("bonusSpin");
            }

            const today = new Date().toISOString().split('T')[0];
            localStorage.setItem("lastSpinDate", today);
          }
        }

        requestAnimationFrame(animate);
      }, 500);
    }

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    spinBtn.addEventListener("click", spinWheel);
  </script>

  <!-- <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const segments = ["Gi·∫£m gi√° 5k v√© phim", "Gi·∫£m gi√° 10k v√© phim", "Ch√∫c may m·∫Øn l·∫ßn sau", "Gi·∫£m gi√° 5k b·∫Øp n∆∞·ªõc", "Gi·∫£m gi√° 50k v√© phim", "+1 l∆∞·ª£t quay"];
    const colors = ["#A3E4D7", "#F9E79F", "#FADBD8", "#D5A6BD", "#00FF00", "#85C1AE"];
    const spinBtn = document.getElementById("spin");
    const result = document.getElementById("result");
    const spinSound = document.getElementById("spinSound");

    let startAngle = 0;
    const arc = Math.PI * 2 / segments.length;
    let spinAngle = 0;

    function drawWheel() {
      for (let i = 0; i < segments.length; i++) {
        const angle = startAngle + i * arc;
        ctx.fillStyle = colors[i];
        ctx.beginPath();
        ctx.moveTo(250, 250);
        ctx.arc(250, 250, 250, angle, angle + arc);
        ctx.closePath();
        ctx.fill();

        ctx.save();
        ctx.translate(250, 250);
        ctx.rotate(angle + arc / 2);
        ctx.fillStyle = "#333";
        ctx.font = "bold 16px Arial";
        ctx.textAlign = "center";
        ctx.fillText(segments[i], 130, 10);
        ctx.restore();
      }
    }
    drawWheel();

    function hasUserSpunToday() {
      const today = new Date().toISOString().split('T')[0]; // L·∫•y ng√†y hi·ªán t·∫°i theo ƒë·ªãnh d·∫°ng YYYY-MM-DD
      const lastSpinDate = localStorage.getItem("lastSpinDate");

      const bonusSpin = localStorage.getItem("bonusSpin");
      if (bonusSpin === "true") {
        result.innerText = localStorage.getItem("result") || "üéÅ B·∫°n c√≥ 1 l∆∞·ª£t quay th∆∞·ªüng üéÅ";

        return false; // V·∫´n ƒë∆∞·ª£c quay n·∫øu ƒëang c√≥ l∆∞·ª£t quay th∆∞·ªüng
      }


      return lastSpinDate === today;
    }

    if (hasUserSpunToday()) {
      spinBtn.disabled = true;
      result.innerText = localStorage.getItem("result");
    } else {
      spinBtn.disabled = false;
    }

    function spinWheel() {
      // V√¥ hi·ªáu h√≥a n√∫t ƒë·ªÉ kh√¥ng b·∫•m nhi·ªÅu l·∫ßn
      spinBtn.disabled = true;

      // Ph√°t nh·∫°c tr∆∞·ªõc
      spinSound.currentTime = 0;
      spinSound.play();

      // Ch·ªù 2 gi√¢y tr∆∞·ªõc khi quay v√≤ng quay
      setTimeout(() => {
        // Danh s√°ch h·ª£p l·ªá (lo·∫°i b·ªè ph·∫ßn 50k)
        const validIndexes = segments
          .map((value, idx) => value !== "Gi·∫£m gi√° 50k v√© phim" ? idx : -1)
          .filter(idx => idx !== -1);

        const selectedIndex = validIndexes[Math.floor(Math.random() * validIndexes.length)];
        const stopAngle = (Math.PI * 3 / 2) - (selectedIndex * arc) - (arc / 2);
        const spins = Math.floor(Math.random() * 10 + 5);
        const totalAngle = spins * 2 * Math.PI + stopAngle;

        const duration = 6000;
        const start = performance.now();

        function animate(now) {
          const elapsed = now - start;
          const progress = Math.min(elapsed / duration, 1);
          spinAngle = totalAngle * easeOutCubic(progress);
          startAngle = spinAngle % (Math.PI * 2);
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          drawWheel();

          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {


            // G√≥c hi·ªán t·∫°i ƒë√£ quay
            let normalizedAngle = (2 * Math.PI - (spinAngle % (2 * Math.PI)) + Math.PI * 3 / 2) % (2 * Math.PI);
            let index = Math.floor(normalizedAngle / arc);

            // Lo·∫°i b·ªè ph·∫ßn "Gi·∫£m gi√° 50k" trong k·∫øt qu·∫£
            if (segments[index] === "Gi·∫£m gi√° 50k v√© phim") {
              index = (index + 1) % segments.length; // Chuy·ªÉn sang ph·∫ßn ti·∫øp theo
            }

            const spinResult = segments[index];
            result.innerText = "üéÅ B·∫°n tr√∫ng: " + spinResult + " üéÅ";
            // localStorage.setItem("hasSpun", "true");

            localStorage.setItem("result", "üéÅ B·∫°n tr√∫ng: " + spinResult + " üéÅ");
            if (spinResult === "+1 l∆∞·ª£t quay") {
              spinBtn.disabled = false; // Hi·ªÉn th·ªã l·∫°i n√∫t quay
              localStorage.setItem("bonusSpin", "true");
            } else {
              localStorage.removeItem("bonusSpin");

            }
            // L∆∞u l·∫°i ng√†y quay
            const today = new Date().toISOString().split('T')[0]; // L∆∞u ng√†y quay
            localStorage.setItem("lastSpinDate", today);

          }
        }

        requestAnimationFrame(animate);
      }, 500); // Delay 2 gi√¢y
    }

    function easeOutCubic(t) {
      return 1 - Math.pow(1 - t, 3);
    }

    spinBtn.addEventListener("click", spinWheel);
  </script> -->
</body>

</html>